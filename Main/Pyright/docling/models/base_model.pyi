"""
This type stub file was generated by pyright.
"""

import numpy as np
from abc import ABC, abstractmethod
from collections.abc import Iterable
from typing import Any, Generic, Optional, Protocol, Type, Union
from docling_core.types.doc import DoclingDocument, NodeItem
from PIL.Image import Image
from typing_extensions import TypeVar
from docling.datamodel.base_models import ItemAndImageEnrichmentElement, Page, VlmPrediction
from docling.datamodel.document import ConversionResult
from docling.datamodel.pipeline_options import BaseOptions
from docling.datamodel.pipeline_options_vlm_model import InlineVlmOptions

class BaseModelWithOptions(Protocol):
    @classmethod
    def get_options_type(cls) -> Type[BaseOptions]:
        ...
    
    def __init__(self, *, options: BaseOptions, **kwargs) -> None:
        ...
    


class BasePageModel(ABC):
    @abstractmethod
    def __call__(self, conv_res: ConversionResult, page_batch: Iterable[Page]) -> Iterable[Page]:
        ...
    


class BaseVlmModel(ABC):
    """Base class for Vision-Language Models that adds image processing capability."""
    @abstractmethod
    def process_images(self, image_batch: Iterable[Union[Image, np.ndarray]], prompt: Union[str, list[str]]) -> Iterable[VlmPrediction]:
        """Process raw images without page metadata.

        Args:
            image_batch: Iterable of PIL Images or numpy arrays
            prompt: Either:
                - str: Single prompt used for all images
                - list[str]: List of prompts (one per image, must match image count)

        Raises:
            ValueError: If prompt list length doesn't match image count.
        """
        ...
    


class BaseVlmPageModel(BasePageModel, BaseVlmModel):
    """Base implementation for VLM models that inherit from BasePageModel.

    Provides a default __call__ implementation that extracts images from pages,
    processes them using process_images, and attaches results back to pages.
    """
    vlm_options: InlineVlmOptions
    processor: Any
    @abstractmethod
    def __call__(self, conv_res: ConversionResult, page_batch: Iterable[Page]) -> Iterable[Page]:
        """Extract images from pages, process them, and attach results back."""
        ...
    
    def formulate_prompt(self, user_prompt: str) -> str:
        """Formulate a prompt for the VLM."""
        ...
    


EnrichElementT = TypeVar("EnrichElementT", default=NodeItem)
class GenericEnrichmentModel(ABC, Generic[EnrichElementT]):
    elements_batch_size: int = ...
    @abstractmethod
    def is_processable(self, doc: DoclingDocument, element: NodeItem) -> bool:
        ...
    
    @abstractmethod
    def prepare_element(self, conv_res: ConversionResult, element: NodeItem) -> Optional[EnrichElementT]:
        ...
    
    @abstractmethod
    def __call__(self, doc: DoclingDocument, element_batch: Iterable[EnrichElementT]) -> Iterable[NodeItem]:
        ...
    


class BaseEnrichmentModel(GenericEnrichmentModel[NodeItem]):
    def prepare_element(self, conv_res: ConversionResult, element: NodeItem) -> Optional[NodeItem]:
        ...
    


class BaseItemAndImageEnrichmentModel(GenericEnrichmentModel[ItemAndImageEnrichmentElement]):
    images_scale: float
    expansion_factor: float = ...
    def prepare_element(self, conv_res: ConversionResult, element: NodeItem) -> Optional[ItemAndImageEnrichmentElement]:
        ...
    


