"""
This type stub file was generated by pyright.
"""

from abc import abstractmethod
from transformers import StoppingCriteria

"""
This type stub file was generated by pyright.
"""
_log = ...
class GenerationStopper:
    """
    Base interface for stopping logic.
    - should_stop(s): True to stop given the current decoded text window.
    - lookback_tokens(): how many tokens should be considered (default: sys.maxsize).
    """
    @abstractmethod
    def should_stop(self, s: str) -> bool:
        ...
    
    def lookback_tokens(self) -> int:
        ...
    


class DocTagsRepetitionStopper(GenerationStopper):
    """
    Detects repetitive <tag>...<loc_x><loc_y><loc_w><loc_h>text</tag> blocks,
    but only when repeats are **consecutive** and both tag & inner text are identical.

    Performance:
    - Heavy check runs every N calls (default 32).
    - Only decodes the last LOOKBACK_TOKENS tokens per sequence (default 200).
    """
    def __init__(self, *, N: int = ..., lookback_tokens: int = ...) -> None:
        ...
    
    def should_stop(self, s: str) -> bool:
        """
        Trip only on **consecutive** runs (no other matched blocks between) of â‰¥3 items
        with the same <tag> and identical inner text, where within that run we see:
          - any exact duplicate (x,y,w,h), or
          - stable X/W with regular Y progression, or
          - stable Y/H with regular X progression.
        """
        ...
    


class HFStoppingCriteriaWrapper(StoppingCriteria):
    """
    Adapts any GenerationStopper to HuggingFace Transformers.
    Decodes exactly min(seq_len, stopper.lookback_tokens()) tokens from the end.
    """
    def __init__(self, tokenizer, stopper: GenerationStopper, *, skip_special_tokens: bool = ...) -> None:
        ...
    
    def __call__(self, input_ids, scores, **kwargs) -> bool:
        ...
    


