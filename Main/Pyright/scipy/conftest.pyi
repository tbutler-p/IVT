"""
This type stub file was generated by pyright.
"""

import pytest
from contextlib import contextmanager
from typing import Literal
from scipy._lib._array_api import SCIPY_ARRAY_API

HAVE_SCPDT = ...
PARALLEL_RUN_AVAILABLE = ...
def pytest_configure(config): # -> None:
    """
    Add pytest markers to avoid PytestUnknownMarkWarning

    This needs to contain all markers that are SciPy-specific, as well as
    dummy fallbacks for markers defined in optional test packages.

    Note that we need both the registration here *and* in `pytest.ini`.
    """
    ...

def pytest_runtest_setup(item): # -> None:
    ...

@pytest.fixture(scope="function", autouse=True)
def check_fpu_mode(request): # -> Generator[None, Any, None]:
    """
    Check FPU mode was not changed during the test.
    """
    ...

if not PARALLEL_RUN_AVAILABLE:
    @pytest.fixture
    def num_parallel_threads(): # -> Literal[1]:
        ...
    
xp_known_backends = ...
xp_available_backends = ...
xp_skip_cpu_only_backends = ...
xp_skip_eager_only_backends = ...
if SCIPY_ARRAY_API:
    default = ...
xp_skip_np_only_backends = ...
@pytest.fixture(params=[pytest.param(v, id=k, marks=pytest.mark.array_api_backends) for (k, v) in xp_available_backends.items()])
def xp(request, monkeypatch): # -> Generator[ModuleType, Any, None]:
    """Run the test that uses this fixture on each available array API library.

    You can select all and only the tests that use the `xp` fixture by
    passing `-m array_api_backends` to pytest.

    You can select where individual tests run through the `@skip_xp_backends`,
    `@xfail_xp_backends`, and `@skip_xp_invalid_arg` pytest markers.

    Please read: https://docs.scipy.org/doc/scipy/dev/api-dev/array_api.html#adding-tests
    """
    ...

skip_xp_invalid_arg = ...
def skip_or_xfail_xp_backends(request: pytest.FixtureRequest, skip_or_xfail: Literal['skip', 'xfail']) -> None:
    """
    Helper of the `xp` fixture.
    Skip or xfail based on the ``skip_xp_backends`` or ``xfail_xp_backends`` markers.

    See the "Support for the array API standard" docs page for usage examples.

    Usage
    -----
    ::
        skip_xp_backends = pytest.mark.skip_xp_backends
        xfail_xp_backends = pytest.mark.xfail_xp_backends
        ...

        @skip_xp_backends(backend, *, reason=None)
        @skip_xp_backends(*, cpu_only=True, exceptions=(), reason=None)
        @skip_xp_backends(*, eager_only=True, exceptions=(), reason=None)
        @skip_xp_backends(*, np_only=True, exceptions=(), reason=None)

        @xfail_xp_backends(backend, *, reason=None)
        @xfail_xp_backends(*, cpu_only=True, exceptions=(), reason=None)
        @xfail_xp_backends(*, eager_only=True, exceptions=(), reason=None)
        @xfail_xp_backends(*, np_only=True, exceptions=(), reason=None)

    Parameters
    ----------
    backend : str, optional
        Backend to skip/xfail, e.g. ``"torch"``.
        Mutually exclusive with ``cpu_only``, ``eager_only``, and ``np_only``.
    cpu_only : bool, optional
        When ``True``, the test is skipped/xfailed on non-CPU devices,
        minus exceptions. Mutually exclusive with ``backend``.
    eager_only : bool, optional
        When ``True``, the test is skipped/xfailed for lazy backends, e.g. those
        with major caveats when invoking ``__array__``, ``__bool__``, ``__float__``,
        or ``__complex__``, minus exceptions. Mutually exclusive with ``backend``.
    np_only : bool, optional
        When ``True``, the test is skipped/xfailed for all backends other
        than the default NumPy backend and the exceptions.
        Mutually exclusive with ``backend``. Implies ``cpu_only`` and ``eager_only``.
    reason : str, optional
        A reason for the skip/xfail. If omitted, a default reason is used.
    exceptions : list[str], optional
        A list of exceptions for use with ``cpu_only``, ``eager_only``, or ``np_only``.
        This should be provided when delegation is implemented for some,
        but not all, non-CPU/non-NumPy backends.
    """
    ...

@pytest.fixture
def devices(xp): # -> list[Any]:
    """Fixture that returns a list of all devices for the backend, plus None.
    Used to test input->output device propagation.

    Usage
    -----
    from scipy._lib._array_api import xp_device

    def test_device(xp, devices):
        for d in devices:
            x = xp.asarray(..., device=d)
            y = f(x)
            assert xp_device(y) == xp_device(x)
    """
    ...

SCIPY_HYPOTHESIS_PROFILE = ...
if HAVE_SCPDT:
    @contextmanager
    def warnings_errors_and_rng(test=...): # -> Generator[None, Any, None]:
        """Temporarily turn (almost) all warnings to errors.

        Filter out known warnings which we allow.
        """
        ...
    
